// package com.example.truenorthdemoproject;

// import io.flutter.embedding.android.FlutterActivity;
// import io.flutter.embedding.engine.FlutterEngine;
// import io.flutter.plugin.common.MethodChannel;
// import android.content.Intent;

// public class MainActivity extends FlutterActivity {
//     private static final String CHANNEL = "location_service";

//     @Override
//     public void configureFlutterEngine(FlutterEngine flutterEngine) {
//         super.configureFlutterEngine(flutterEngine);
//         new MethodChannel(flutterEngine.getDartExecutor().getBinaryMessenger(), CHANNEL)
//                 .setMethodCallHandler(
//                         (call, result) -> {
//                             if (call.method.equals("startService")) {
//                                 if(checkAndRequestPermissions)
//                                 {
//                                     startLocationService
//                                     result.success(null);
                                    
//                                 }
//                                 else{
//                                     result.error("PERMISSION_DENIED", "Location permission denied", null);
//                                 }

//                                 Intent intent = new Intent(this, LocationService.class);
//                                 startForegroundService(intent);
//                                 result.success(null);
//                             } else if (call.method.equals("stopService")) {
//                                 Intent intent = new Intent(this, LocationService.class);
//                                 stopService(intent);
//                                 result.success(null);
//                             } else {
//                                 result.notImplemented();
//                             }
//                         }
//                 );
//     }
//  private boolean checkAndRequestPermissions(){}
//  private void startLocationService() {
//         Intent intent = new Intent(this, LocationService.class);
//         ContextCompat.startForegroundService(this, intent);
//     }
//       private void stopLocationService() {
//         Intent intent = new Intent(this, LocationService.class);
//         stopService(intent);
//     }
  
// }
// package com.example.truenorthdemoproject;

// import android.Manifest;
// import android.content.Intent;
// import android.content.pm.PackageManager;
// import android.net.Uri;
// import android.os.Build;
// import android.provider.Settings;
// import androidx.annotation.NonNull;
// import androidx.core.app.ActivityCompat;
// import androidx.core.content.ContextCompat;
// import io.flutter.embedding.android.FlutterActivity;
// import io.flutter.embedding.engine.FlutterEngine;
// import io.flutter.plugin.common.MethodChannel;

// public class MainActivity extends FlutterActivity {
//     private static final String CHANNEL = "location_service";
//     private static final int LOCATION_PERMISSION_REQUEST = 1001;

//     @Override
//     public void configureFlutterEngine(@NonNull FlutterEngine flutterEngine) {
//         super.configureFlutterEngine(flutterEngine);

//         new MethodChannel(flutterEngine.getDartExecutor().getBinaryMessenger(), CHANNEL)
//                 .setMethodCallHandler((call, result) -> {
//                     if (call.method.equals("startService")) {
//                         if (checkAndRequestPermissions()) {
//                             startLocationService();
//                             result.success(null);
//                         } else {
//                             result.error("PERMISSION_DENIED", "Location permission denied", null);
//                         }
//                     } else if (call.method.equals("stopService")) {
//                         stopLocationService();
//                         result.success(null);
//                     } else {
//                         result.notImplemented();
//                     }
//                 });
//     }

//     private boolean checkAndRequestPermissions() {
//         if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.Q) {
//             if (ContextCompat.checkSelfPermission(this, Manifest.permission.ACCESS_FINE_LOCATION) != PackageManager.PERMISSION_GRANTED ||
//                     ContextCompat.checkSelfPermission(this, Manifest.permission.ACCESS_BACKGROUND_LOCATION) != PackageManager.PERMISSION_GRANTED) {
//                 ActivityCompat.requestPermissions(this,
//                         new String[]{
//                                 Manifest.permission.ACCESS_FINE_LOCATION,
//                                 Manifest.permission.ACCESS_COARSE_LOCATION,
//                                 Manifest.permission.ACCESS_BACKGROUND_LOCATION
//                         },
//                         LOCATION_PERMISSION_REQUEST);
//                 return false;
//             }
//         } else {
//             if (ContextCompat.checkSelfPermission(this, Manifest.permission.ACCESS_FINE_LOCATION) != PackageManager.PERMISSION_GRANTED) {
//                 ActivityCompat.requestPermissions(this,
//                         new String[]{Manifest.permission.ACCESS_FINE_LOCATION},
//                         LOCATION_PERMISSION_REQUEST);
//                 return false;
//             }
//         }
//         return true;
//     }

//     private void startLocationService() {
//         Intent intent = new Intent(this, LocationService.class);
//         ContextCompat.startForegroundService(this, intent);
//     }

//     private void stopLocationService() {
//         Intent intent = new Intent(this, LocationService.class);
//         stopService(intent);
//     }

//     @Override
//     public void onRequestPermissionsResult(int requestCode, @NonNull String[] permissions,
//                                            @NonNull int[] grantResults) {
//         super.onRequestPermissionsResult(requestCode, permissions, grantResults);
//         if (requestCode == LOCATION_PERMISSION_REQUEST) {
//             boolean allGranted = true;
//             for (int result : grantResults) {
//                 if (result != PackageManager.PERMISSION_GRANTED) {
//                     allGranted = false;
//                     break;
//                 }
//             }

//             if (!allGranted) {
//                 // Open app settings if denied
//                 Intent intent = new Intent(Settings.ACTION_APPLICATION_DETAILS_SETTINGS);
//                 Uri uri = Uri.fromParts("package", getPackageName(), null);
//                 intent.setData(uri);
//                 intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
//                 startActivity(intent);
//             } else {
//                 startLocationService();
//             }
//         }
//     }
// }

// package com.example.truenorthdemoproject;

// import io.flutter.embedding.android.FlutterActivity;
// import io.flutter.embedding.engine.FlutterEngine;
// import io.flutter.plugin.common.MethodChannel;
// import android.content.Intent;
// import android.location.LocationManager;
// import android.provider.Settings;
// import android.content.Context;

// public class MainActivity extends FlutterActivity {
//     private static final String CHANNEL = "location_service";

//     @Override
//     public void configureFlutterEngine(FlutterEngine flutterEngine) {
//         super.configureFlutterEngine(flutterEngine);

//         new MethodChannel(flutterEngine.getDartExecutor().getBinaryMessenger(), CHANNEL)
//                 .setMethodCallHandler((call, result) -> {
//                     if (call.method.equals("startService")) {
//                         if (isLocationEnabled()) {
//                             Intent intent = new Intent(this, LocationService.class);
//                             startForegroundService(intent);
//                             result.success("Service Started");
//                         } else {
//                             // GPS off â€” open settings
//                             Intent intent = new Intent(Settings.ACTION_LOCATION_SOURCE_SETTINGS);
//                             intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
//                             startActivity(intent);
//                             result.error("GPS_OFF", "Please enable GPS", null);
//                         }
//                     } else if (call.method.equals("stopService")) {
//                         Intent intent = new Intent(this, LocationService.class);
//                         stopService(intent);
//                         result.success("Service Stopped");
//                     } else {
//                         result.notImplemented();
//                     }
//                 });
//     }

//     private boolean isLocationEnabled() {
//         LocationManager lm = (LocationManager) getSystemService(Context.LOCATION_SERVICE);
//         return lm.isProviderEnabled(LocationManager.GPS_PROVIDER) ||
//                 lm.isProviderEnabled(LocationManager.NETWORK_PROVIDER);
//     }
// }
// package com.example.truenorthdemoproject;

// import io.flutter.embedding.android.FlutterActivity;
// import io.flutter.embedding.engine.FlutterEngine;
// import io.flutter.plugin.common.MethodChannel;
// import android.content.Intent;
// import android.location.LocationManager;
// import android.provider.Settings;
// import android.content.Context;

// public class MainActivity extends FlutterActivity {
//     private static final String CHANNEL = "location_service";

//     @Override
//     public void configureFlutterEngine(FlutterEngine flutterEngine) {
//         super.configureFlutterEngine(flutterEngine);

//         new MethodChannel(flutterEngine.getDartExecutor().getBinaryMessenger(), CHANNEL)
//                 .setMethodCallHandler((call, result) -> {
//                     if (call.method.equals("startService")) {
//                         if (isLocationEnabled()) {
//                             Intent intent = new Intent(this, LocationService.class);
//                             startForegroundService(intent);
//                             result.success("Service Started");
//                         } else {
//                             Intent intent = new Intent(Settings.ACTION_LOCATION_SOURCE_SETTINGS);
//                             intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
//                             startActivity(intent);
//                             result.error("GPS_OFF", "Please enable GPS", null);
//                         }
//                     } else if (call.method.equals("stopService")) {
//                         Intent intent = new Intent(this, LocationService.class);
//                         stopService(intent);
//                         result.success("Service Stopped");
//                     } else {
//                         result.notImplemented();
//                     }
//                 });
//     }

//     private boolean isLocationEnabled() {
//         LocationManager lm = (LocationManager) getSystemService(Context.LOCATION_SERVICE);
//         return lm.isProviderEnabled(LocationManager.GPS_PROVIDER) ||
//                lm.isProviderEnabled(LocationManager.NETWORK_PROVIDER);
//     }
// }
package com.example.truenorthdemoproject;

import io.flutter.embedding.android.FlutterActivity;
import io.flutter.embedding.engine.FlutterEngine;
import io.flutter.plugin.common.MethodChannel;
import android.content.Intent;
import android.location.LocationManager;
import android.provider.Settings;
import android.content.Context;

public class MainActivity extends FlutterActivity {
    private static final String CHANNEL = "location_service";

    @Override
    public void configureFlutterEngine(FlutterEngine flutterEngine) {
        super.configureFlutterEngine(flutterEngine);

        new MethodChannel(flutterEngine.getDartExecutor().getBinaryMessenger(), CHANNEL)
                .setMethodCallHandler((call, result) -> {
                    if (call.method.equals("startService")) {
                        if (isLocationEnabled()) {
                            Intent intent = new Intent(this, LocationService.class);
                            startForegroundService(intent);
                            result.success("Service Started");
                        } else {
                            Intent intent = new Intent(Settings.ACTION_LOCATION_SOURCE_SETTINGS);
                            intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
                            startActivity(intent);
                            result.error("GPS_OFF", "Please enable GPS", null);
                        }
                    } else if (call.method.equals("stopService")) {
                        Intent intent = new Intent(this, LocationService.class);
                        stopService(intent);
                        result.success("Service Stopped");
                    } else {
                        result.notImplemented();
                    }
                });
    }

    private boolean isLocationEnabled() {
        LocationManager lm = (LocationManager) getSystemService(Context.LOCATION_SERVICE);
        return lm.isProviderEnabled(LocationManager.GPS_PROVIDER) ||
               lm.isProviderEnabled(LocationManager.NETWORK_PROVIDER);
    }
}
